<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VibeCheck | 全球高顏值地圖</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #050505; color: #eee; font-family: -apple-system, system-ui; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.08); }
        .vibe-gradient { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="pb-24">
    <header class="sticky top-0 z-50 glass px-6 py-4 flex justify-between items-center">
        <h1 class="text-2xl font-black vibe-gradient italic">VibeCheck</h1>
    </header>

    <main id="list" class="px-6 space-y-6 mt-6">
        <div class="text-center py-20 text-gray-500 italic">同步資料庫訊號中...</div>
    </main>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQB13No18KjJp619uNWQGXd2ZEyMqQP0Bho2fFifMIANH7x24G26WYtgO5olQfd3vtILyyhHSe0L5Nh/pub?output=csv";

        async function loadData() {
            try {
                const response = await fetch(CSV_URL);
                const text = await response.text();
                // 使用正則表達式處理 CSV 換行與逗點，並跳過標題列
                const lines = text.split(/\r?\n/).filter(line => line.trim() !== "").slice(1);
                
                const shops = lines.map(line => {
                    // 精準切割欄位並去除前後空格與引號
                    const cols = line.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                    return {
                        city: cols[1] || "",
                        area: cols[2] || "",
                        name: cols[3] || "",
                        vibe: cols[4] || "",
                        ig: cols[5] || "#",
                        book: cols[6] || "#"
                    };
                });
                render(shops);
            } catch (e) {
                document.getElementById('list').innerHTML = "載入失敗，請確認網路連線";
            }
        }

        function render(data) {
            const list = document.getElementById('list');
            list.innerHTML = data.map(shop => `
                <div class="glass rounded-[2rem] p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="text-[10px] text-pink-500 font-bold tracking-widest">${shop.city} · ${shop.area}</span>
                            <h2 class="text-xl font-bold mt-1">${shop.name}</h2>
                        </div>
                    </div>
                    <p class="text-gray-400 text-sm mb-5">${shop.vibe}</p>
                    <div class="grid grid-cols-2 gap-3">
                        <a href="${shop.ig}" target="_blank" class="bg-white text-black text-center py-3 rounded-2xl font-black text-xs">即時驗證</a>
                        <a href="${shop.book}" target="_blank" class="border border-white/20 text-center py-3 rounded-2xl font-bold text-xs">一鍵訂位</a>
                    </div>
                </div>
            `).join('');
        }

        loadData();
    </script>
</body>
</html>
